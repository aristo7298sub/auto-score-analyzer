# 管理员后台系统使用指南

## 功能概览

管理员后台提供三个主要模块：

### 1. 数据概览（Dashboard）
- **总用户数**：系统注册的所有用户
- **活跃用户**：最近30天内登录过的用户
- **VIP用户**：已开通VIP权限的用户数量
- **总分析次数**：系统累计完成的分析次数
- **成功/失败分析**：分析任务的执行统计
- **总配额消耗**：所有用户累计使用的配额数量

### 2. 用户管理（Users）
提供完整的用户管理功能：

#### 用户列表
- 显示用户ID、用户名、邮箱、VIP状态、账号状态
- 显示配额余额、已用配额、推荐人数
- 显示注册时间和最后登录时间

#### 用户操作
- **设置/取消VIP**：为用户开通或取消VIP权限（VIP用户无限配额）
- **启用/禁用账号**：控制用户账号的可用状态
- **添加配额**：为普通用户手动添加配额
  - 可设置配额数量
  - 可添加备注说明（记录添加原因）

#### 搜索功能
- 支持按用户名或邮箱搜索
- 实时过滤用户列表

### 3. 分析日志（Logs）
查看所有用户的分析记录：
- 用户信息、文件名
- 学生数量、配额消耗
- 执行状态（成功/失败/处理中）
- 执行时间、错误信息

## 访问权限

### 如何设置管理员
管理员权限需要在数据库中设置，步骤如下：

1. 注册一个普通账号
2. 在数据库中找到该用户记录
3. 将 `is_admin` 字段设置为 `true`
4. 重新登录后即可看到"管理后台"入口

### SQL示例（SQLite）
```sql
-- 查看所有用户
SELECT id, username, email, is_admin FROM users;

-- 设置用户为管理员
UPDATE users SET is_admin = 1 WHERE username = 'admin';

-- 取消管理员权限
UPDATE users SET is_admin = 0 WHERE username = 'username';
```

## 页面路由
- 路径：`/admin`
- 权限要求：`is_admin = true`
- 未授权用户无法访问，会自动跳转到首页

## API接口

管理员后台使用以下API端点：

### 获取统计数据
```
GET /api/admin/stats
```

### 获取用户列表
```
GET /api/admin/users?limit=100&offset=0&search=keyword
```

### 设置VIP
```
POST /api/admin/users/set-vip
Body: { "user_id": 1, "is_vip": true }
```

### 启用/禁用账号
```
POST /api/admin/users/{user_id}/toggle-active
```

### 添加配额
```
POST /api/quota/admin/add
Body: { "user_id": 1, "amount": 100, "description": "补充配额" }
```

### 获取分析日志
```
GET /api/admin/logs?limit=100&offset=0&status_filter=success&user_id=1
```

## 安全建议

1. **限制管理员数量**：只授权必要的人员
2. **定期审计**：检查管理员操作日志
3. **强密码策略**：管理员账号使用复杂密码
4. **操作记录**：所有配额添加都会记录在交易历史中
5. **禁用而非删除**：使用"禁用账号"功能而不是删除用户

## UI特性

- **莫兰迪色调**：与前端主题保持一致
- **响应式设计**：支持桌面和移动设备
- **实时更新**：操作后自动刷新数据
- **状态标识**：使用颜色和图标清晰展示状态
- **操作确认**：重要操作自动显示成功/失败消息

## 常见操作场景

### 场景1：新用户配额不足
1. 进入"用户管理"
2. 搜索用户名或邮箱
3. 点击"加配额"按钮
4. 输入配额数量和备注
5. 确认添加

### 场景2：设置VIP用户
1. 进入"用户管理"
2. 找到目标用户
3. 点击"设为VIP"按钮
4. 确认操作
5. 用户立即获得无限配额

### 场景3：禁用异常账号
1. 进入"用户管理"
2. 找到异常用户
3. 点击"禁用"按钮
4. 用户无法登录和使用系统

### 场景4：查看系统健康度
1. 进入"数据概览"
2. 查看成功率 = 成功分析 / 总分析次数
3. 如果失败率过高，查看"分析日志"了解详情
4. 根据错误信息进行系统优化

## 未来扩展

计划中的功能（待开发）：
- [ ] 批量操作（批量添加配额、批量设置VIP）
- [ ] 导出用户列表和统计报表
- [ ] 自定义配额套餐（例如：月卡、年卡）
- [ ] 系统公告管理
- [ ] 操作日志审计（记录管理员所有操作）
- [ ] 实时监控Dashboard（WebSocket推送）
- [ ] 邮件通知功能（配额不足、账号异常等）
